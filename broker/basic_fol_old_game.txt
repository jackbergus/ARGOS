

BOGUS {
    turns{magnitude:single,ordering:strict}
    roles{speaker,listener}
    players{min:2, max:undefined}
    player{id:Proposer,roles{speaker}}
    player{id:Evaluator,roles{listener}}
     store { id: Stacko, owner: shared, structure: stack, visibility : public   }
    store { id: Playerso, owner: shared, structure: stack, visibility : public  }
    

    rule{id:StartingRule, scope:initial, {  move(add, next, Subscribeo, Evaluator)
     }}


    ////// Section: o

    // The publisher stops all the subscribers to register and to do whatsever operation, then, it starts adding the data
    interaction { StartPublisho , { move(delete, next, Subscribeo, $Evaluator, Evaluator) &
                                   move(add, next, Publisho, $Proposer, {p}, Proposer)
                                 }
                }
    // This might have been better expressed with a while-true loop, but anyway, expressing that the publisher shall
    // repeat in the stack as many arguments as the number of players, while allowing the players only to publish
    interaction { Publisho , {
                                if { magnitude(Stacko, shared, smaller, Playerso, shared) } then
                                { store(add, {p}, Stacko, listener) &
                                  move(add, next, Publisho, $Proposer, {p}, Proposer) }
                                // When I reach the maximum capacity, I enforce all the players to re-register if they want to
                                // subscribe to the next round, and allowing all the players to consume. The language seems
                                else
                                { store(empty, {"bogus"}, Playerso, listener) &
                                  move(add, next, Consumeo, $Evaluator, Evaluator)  }
                            }
                }

    //interaction { Consumeo , { store(get, {p}, Stacko, listener) } }

    // First, someone can publish only if someone subscribed. This still allows other services to subscribe, and enables
    // the client to start publishing
    interaction { Subscribeo, { move(add, next, StartPublisho, $Proposer, Proposer) &
                               store(add, {s}, Playerso, listener) &
                               move(add, next, Subscribeo, Evaluator)
                             }
                }




}
